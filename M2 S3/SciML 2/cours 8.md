这份总结涵盖了你提供的球面图神经网络（GNN）实战代码，重点解析了 **球面采样、图拉普拉斯构建、GraphSAGE 与 ChebNet 的 JAX 实现**。

---

## 📄 SciML 2: 球面图神经网络实战速记 (A4版)

### 1. 数据生成：球面物理环境

- **球面采样 (Sampling)**：
    
    - **均匀采样**：利用 $\theta = 2\pi u, \phi = \arccos(2v-1)$ 保证球面上单位面积点数一致。
        
    - **密度采样**：结合高斯分布在特定区域（$\theta_0, \phi_0$）聚集点，模拟非均匀观测。
        
- **数据集构造**：
    
    - **基底**：使用球面谐函数（Spherical Harmonics, $Y_{lm}$）作为物理基底。
        
    - **映射**：给定解 $u$，通过图拉普拉斯算子 $L$ 计算源项 $f = -L u$。训练目标是学习逆映射 $f \to u$。
        

---

### 2. 图结构构建 (Graph Building)

- **邻接矩阵 $A$**：使用 `kneighbors_graph` (k-NN) 建立局部连接。
    
- **对称化**：$A = 0.5(A + A^T)$ 确保无向图属性。
    
- **图拉普拉斯 $L$**：$L = D - A$。它捕捉了球面上函数的局部二阶导数（扩散信息）。
    

---

### 3. 核心算子实现 (Equinox / JAX)

#### A. GraphSAGE (空间域算子)

- **公式**：$h'_i = \sigma(W [h_i, \text{mean}_{j \in N(i)} h_j] + b)$
    
- **代码逻辑**：
    
    - 聚合：`neigh = A @ X / deg`（通过矩阵乘法快速实现邻域平均）。
        
    - 拼接：`jnp.concatenate([X, neigh], axis=1)` 保留自身信息与邻域信息。
        
    - **Inductive Bias**：局部聚合，平移等变。
        

#### B. ChebNet (谱域近似算子)

- **公式**：基于切比雪夫多项式递归 $P_k = 2 L_s P_{k-1} - P_{k-2}$。
    
- **归一化**：$L_s = \frac{2}{\lambda_{max}}L - I$，将特征值缩放到 $[-1, 1]$ 以保证递归稳定性。
    
- **代码逻辑**：
    
    - 通过循环计算 $T_k(L)X$，模拟谱域滤波器。
        
    - **优势**：不需要特征值分解即可实现“$K$ 阶跳跃”的谱过滤，捕捉全局/半全局信息。
        

---

### 4. 架构设计：GraphResNet

- **残差连接 (Residual Block)**：
    
    - `X + Layer(X)`。
        
    - **作用**：解决深度 GNN 的过平滑（Over-smoothing）问题，允许模型学习更复杂的特征映射。
        
- **Readout 层**：
    
    - 最后的线性映射层将隐藏层维度（`hidden_dim`）映射回物理标量输出（`out_dim=1`）。
        

---

### 5. 训练技巧 (JAX/Optax)

- **向量化训练**：使用 `jax.vmap(model)` 同时处理 batch 中的多个球面算子任务。
    
- **Mini-batch 采样**：从 75 个谐函数模态中随机抽取进行训练。
    
- **JIT 加速**：`@eqx.filter_jit` 应用于 `step` 和 `loss_fn`，极大地提高了 GPU 上的训练效率。
    

---

### 💡 考场核心笔记 (Cheat Sheet)

1. **如何选择层类型？** - **GraphSAGE**：更强调局部交互，计算开销小。
    
    - **ChebNet**：更接近解析解的谱表达，处理具有全局物理规律（如球面波动）的问题效果更好。
        
2. **λ_max 的意义**：在 ChebNet 中，不进行归一化会导致递归计算时数值爆炸。
    
3. **数据维度**：输入通常是 `(Nodes, Channels)`。在 PINNs 或算子学习中，Channels 通常由 $f$ 的物理分量组成。
    

---

**这页总结将球面几何、图算子公式与 JAX 代码实现逻辑紧密结合，是应对 SciML 算子学习考试的有力工具。**