#include <stdio.h>
#include <stdarg.h>
#include <stdnoreturn.h>
#include <stdlib.h>
#include <fcntl.h>
#include <unistd.h>

#define CHK(op) do { if ((op) == -1) raler(1, #op); } while (0)

#define BUFFER_SIZE 8192

noreturn void raler(int syserr, const char *msg, ...) {
    va_list ap;
    va_start(ap, msg);
    vfprintf(stderr, msg, ap);
    fprintf(stderr, "\n");
    va_end(ap);

    if (syserr) {
        perror("");
    }

    exit(EXIT_FAILURE);
}

int main(int argc, char *argv[]) {
    if (argc != 3) {
        raler(0, "usage: %s NomFichier1 NomFichier2", argv[0]);
    }

    int fd1, fd2;
    char buf[BUFFER_SIZE];
    ssize_t nbl;
    
    CHK(fd1 = open(argv[1], O_RDONLY));

    CHK(fd2 = open(argv[2], O_WRONLY | O_CREAT | O_TRUNC, 0666));

    while ((nbl = read(fd1, buf, BUFFER_SIZE)) > 0) {
        CHK(write(fd2, buf, nbl));
    }

    CHK(nbl);

    CHK(close(fd1));
    CHK(close(fd2));

    return 0;
}
